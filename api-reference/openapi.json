{
  "openapi": "3.1.0",
  "info": {
    "title": "UIP API",
    "description": "Universal Identity Protocol API for biometric authentication, signatures, and messaging",
    "version": "1.0.0",
    "contact": {
      "name": "UIP Support",
      "email": "support@uip.digital",
      "url": "https://business.uip.digital"
    }
  },
  "servers": [
    {
      "url": "https://api.uip.digital/v1",
      "description": "Production"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/identify": {
      "post": {
        "summary": "Identify Identity",
        "description": "Identify and verify a user's identity with biometric verification. Returns a QR code or deep link for the user to scan.",
        "operationId": "identify",
        "tags": ["Identity"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/IdentifyRequest"
              },
              "examples": {
                "basic": {
                  "summary": "Basic authentication",
                  "value": {
                    "intent": "Sign in to Example App",
                    "requested_data": ["name", "birthdate"]
                  }
                },
                "age_verification": {
                  "summary": "Age verification only",
                  "value": {
                    "intent": "Verify you're 18+ to access content",
                    "requested_data": ["birthdate"]
                  }
                },
                "full_profile": {
                  "summary": "Complete profile",
                  "value": {
                    "intent": "Complete your profile setup"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Authentication session created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/IdentifyResponse"
                },
                "examples": {
                  "success": {
                    "value": {
                      "session_id": "sess_abc123def456",
                      "qr_code": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
                      "expires_at": "2025-01-11T12:35:00Z"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/sign": {
      "post": {
        "summary": "Request Signature",
        "description": "Request a legally binding biometric signature from a user",
        "operationId": "sign",
        "tags": ["Signatures"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SignRequest"
              },
              "examples": {
                "tos": {
                  "summary": "Terms of Service",
                  "value": {
                    "intent": "Sign Terms of Service",
                    "signature_information": "I agree to the Terms of Service version 2.1 dated January 11, 2025"
                  }
                },
                "privacy_policy": {
                  "summary": "Privacy Policy",
                  "value": {
                    "intent": "Acknowledge Privacy Policy",
                    "signature_information": "I acknowledge and agree to the Privacy Policy updated January 2025"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Signature request created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SignResponse"
                },
                "examples": {
                  "success": {
                    "value": {
                      "session_id": "sess_abc123def456",
                      "qr_code": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
                      "expires_at": "2025-01-11T12:35:00Z"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/message": {
      "post": {
        "summary": "Send Message",
        "description": "Send an encrypted message to a UIP user with optional PDF attachments (up to 20MB) and signature requests",
        "operationId": "message",
        "tags": ["Messaging"],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "$ref": "#/components/schemas/MessageRequestWithAttachment"
              },
              "examples": {
                "text_only": {
                  "summary": "Text message without attachment",
                  "value": {
                    "intent": "Account Statement Ready",
                    "message": "Your Q4 2024 account statement is now available for review.",
                    "priority": "MEDIUM",
                    "receiver_uip": "user_abc123def456",
                    "signature_required": false
                  }
                },
                "text_with_signature": {
                  "summary": "Text message with signature required",
                  "value": {
                    "intent": "Sign Employment Contract",
                    "message": "Please review and sign your employment contract by January 31, 2025.",
                    "priority": "HIGH",
                    "receiver_uip": "user_abc123def456",
                    "signature_required": true,
                    "signature_expiry": "2025-01-31T23:59:59Z"
                  }
                },
                "attachments": {
                  "summary": "PDF attachments",
                  "value": {
                    "intent": "Review Contract Package",
                    "message": "Please review the attached contract, terms, and addendum documents.",
                    "priority": "MEDIUM",
                    "receiver_uip": "user_abc123def456",
                    "signature_required": false,
                    "attachments": ["@/path/to/contract.pdf", "@/path/to/terms.pdf", "@/path/to/addendum.pdf"]
                  }
                },
                "attachments_with_signature": {
                  "summary": "PDF attachments with signature",
                  "value": {
                    "intent": "Review Contract Package",
                    "message": "Please review the attached contract, terms, and addendum documents.",
                    "priority": "MEDIUM",
                    "receiver_uip": "user_abc123def456",
                    "signature_required": true,
                    "signature_expiry": "2025-02-15T17:00:00Z",
                    "attachments": ["@/path/to/contract.pdf", "@/path/to/terms.pdf", "@/path/to/addendum.pdf"]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Message sent successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MessageResponse"
                },
                "examples": {
                  "success": {
                    "value": {
                      "message_id": "msg_abc123def456"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/invalidate": {
      "post": {
        "summary": "Invalidate Message",
        "description": "Invalidate a signature-required message that hasn't been signed yet. The message will remain visible to the user but cannot be signed after invalidation.",
        "operationId": "invalidate",
        "tags": ["Messages"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/InvalidateRequest"
              },
              "examples": {
                "message": {
                  "summary": "Invalidate signature-required message",
                  "value": {
                    "message_id": "msg_abc123def456"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Message invalidated successfully. Returns HTTP 200 status code only, no response body.",
            "content": {
              "text/plain": {
                "example": "Message invalidated successfully. Returns HTTP 200 status code only, no response body."
              }
            }
          }
        }
      }
    },
    "/audit/{auditID}": {
      "get": {
        "summary": "Get Audit Record",
        "description": "Retrieve the complete audit record for a completed action",
        "operationId": "audit",
        "tags": ["Audit"],
        "parameters": [
          {
            "name": "auditID",
            "in": "path",
            "required": true,
            "description": "The audit ID returned from webhook responses (audit_id field)",
            "schema": {
              "type": "string"
            },
            "example": "audit_9z8y7x6w5v4u"
          }
        ],
        "responses": {
          "200": {
            "description": "Audit record retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuditResponse"
                },
                "examples": {
                  "signed_message": {
                    "summary": "Signed message with attachment",
                    "value": {
                      "audit": {
                        "created_at": "2025-01-11T14:30:00Z",
                        "requester_uip_id": "business_abc123",
                        "requester_sign_intent": "Sign Employment Contract",
                        "requester_sign_information": "Please review and sign your employment contract by January 31, 2025.",
                        "signatoree_uip_id": "user_def456",
                        "message_ref": "msg_xyz789abc123",
                        "attachment_refs": ["audit_abc123___msg_xyz789___contract.pdf"],
                        "audit_type": "message",
                        "requester_name": "HR Manager",
                        "signatoree_name": "John Doe",
                        "requester_business_name": "Acme Corp",
                        "signed_accepted": true
                      },
                      "attachments": [
                        {
                          "filename": "contract.pdf",
                          "content_type": "application/pdf",
                          "content": "JVBERi0xLjQKJeLjz9MKMSAwIG9iago8PC9UeXBlL0NhdGFs...",
                          "size": 245678
                        }
                      ]
                    }
                  },
                  "declined_signature": {
                    "summary": "Declined signature request",
                    "value": {
                      "audit": {
                        "created_at": "2025-01-11T10:15:00Z",
                        "requester_uip_id": "business_abc123",
                        "requester_sign_intent": "Sign Terms of Service",
                        "requester_sign_information": "I agree to the Terms of Service version 2.1",
                        "signatoree_uip_id": "user_xyz789",
                        "message_ref": null,
                        "attachment_refs": null,
                        "audit_type": "sign",
                        "requester_name": "Platform Admin",
                        "signatoree_name": "Jane Smith",
                        "requester_business_name": "Tech Startup Inc",
                        "signed_accepted": false
                      },
                      "attachments": []
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/webhook/ping": {
      "post": {
        "summary": "Test Webhook",
        "description": "Test your webhook endpoint configuration by sending a test notification to the webhook URL configured in your Business Dashboard",
        "operationId": "webhookTest",
        "tags": ["Webhooks"],
        "responses": {
          "200": {
            "description": "Webhook test sent successfully. Returns HTTP 200 OK status with no response body.",
            "content": {
              "text/plain": {
                "example": "HTTP/1.1 200 OK"
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "IdentifyRequest": {
        "type": "object",
        "required": ["intent"],
        "properties": {
          "intent": {
            "type": "string",
            "description": "Description of why you're requesting identity verification. Shown to the user in the UIP app."
          },
          "requested_data": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": ["name", "birthdate", "country"]
            },
            "description": "Optional array of identity attributes to request. If omitted or empty, all data is returned. Valid values: name, birthdate, country"
          }
        }
      },
      "IdentifyResponse": {
        "type": "object",
        "properties": {
          "session_id": {
            "type": "string",
            "description": "Unique identifier for this authentication session"
          },
          "qr_code": {
            "type": "string",
            "description": "Base64-encoded PNG image of the QR code for users to scan"
          },
          "expires_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp when the session expires (5 minutes from creation)"
          }
        }
      },
      "SignRequest": {
        "type": "object",
        "required": ["intent", "signature_information"],
        "properties": {
          "intent": {
            "type": "string",
            "description": "Description of why you're requesting a signature. Shown to the user in the UIP app."
          },
          "signature_information": {
            "type": "string",
            "description": "The content or description of what the user is signing. This is the actual agreement text or reference."
          }
        }
      },
      "SignResponse": {
        "type": "object",
        "properties": {
          "session_id": {
            "type": "string",
            "description": "Unique identifier for this signature session"
          },
          "qr_code": {
            "type": "string",
            "description": "Base64-encoded PNG image of the QR code for users to scan"
          },
          "expires_at": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp when the session expires (5 minutes from creation)"
          }
        }
      },
      "MessageRequest": {
        "type": "object",
        "required": ["intent", "message", "priority", "receiver_uip", "signature_required"],
        "properties": {
          "intent": {
            "type": "string",
            "description": "Description of why you're sending the message. Shown to the user in the UIP app as the message subject/title."
          },
          "message": {
            "type": "string",
            "description": "The message content/body. This is the actual message text the recipient will read."
          },
          "priority": {
            "type": "string",
            "enum": ["LOW", "MEDIUM", "HIGH", "EXTREME"],
            "description": "Notification priority level that controls how the message appears to the user."
          },
          "receiver_uip": {
            "type": "string",
            "description": "The UIP ID of the message recipient. Must be a valid UIP user identifier."
          },
          "signature_required": {
            "type": "boolean",
            "description": "Flag indicating whether the recipient must sign the message."
          },
          "signature_expiry": {
            "type": "string",
            "format": "date-time",
            "description": "Expiry date for signature requests in RFC3339 format. Only applies when signature_required is true. Defaults to 7 days from message creation. Maximum allowed: 3 months."
          }
        }
      },
      "MessageRequestWithAttachment": {
        "type": "object",
        "required": ["intent", "message", "priority", "receiver_uip", "signature_required"],
        "properties": {
          "intent": {
            "type": "string",
            "description": "Description of why you're sending the message. Shown to the user in the UIP app as the message subject/title."
          },
          "message": {
            "type": "string",
            "description": "The message content/body. This is the actual message text the recipient will read."
          },
          "priority": {
            "type": "string",
            "enum": ["LOW", "MEDIUM", "HIGH", "EXTREME"],
            "description": "Notification priority level that controls how the message appears to the user."
          },
          "receiver_uip": {
            "type": "string",
            "description": "The UIP ID of the message recipient. Must be a valid UIP user identifier."
          },
          "signature_required": {
            "type": "boolean",
            "description": "Flag indicating whether the recipient must sign the message."
          },
          "signature_expiry": {
            "type": "string",
            "format": "date-time",
            "description": "Expiry date for signature requests in RFC3339 format. Only applies when signature_required is true. Defaults to 7 days from message creation. Maximum allowed: 3 months."
          },
          "attachments": {
            "type": "string",
            "format": "binary",
            "description": "PDF file(s) to attach to the message. Format: PDF only. Size limit: 20MB combined for all attachments."
          }
        }
      },
      "MessageResponse": {
        "type": "object",
        "required": ["message_id"],
        "properties": {
          "message_id": {
            "type": "string",
            "description": "Unique message identifier. Save this ID to track message status and reference it in webhook handlers."
          }
        }
      },
      "InvalidateRequest": {
        "type": "object",
        "required": ["message_id"],
        "properties": {
          "message_id": {
            "type": "string",
            "description": "Message ID to invalidate. Only works for signature-required messages that haven't been signed yet."
          }
        }
      },
      "AuditResponse": {
        "type": "object",
        "properties": {
          "audit": {
            "type": "object",
            "properties": {
              "created_at": {
                "type": "string",
                "format": "date-time",
                "description": "ISO 8601 timestamp when the action was completed"
              },
              "requester_uip_id": {
                "type": "string",
                "description": "UIP ID of the business that requested the action"
              },
              "requester_sign_intent": {
                "type": "string",
                "description": "The intent message shown to the user (subject/title of the request)"
              },
              "requester_sign_information": {
                "type": "string",
                "description": "The signature information or message content"
              },
              "signatoree_uip_id": {
                "type": "string",
                "description": "UIP ID of the user who signed or declined"
              },
              "message_ref": {
                "type": "string",
                "nullable": true,
                "description": "Message ID reference if this was a message-based signature. Null for lightweight signatures."
              },
              "attachment_refs": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "nullable": true,
                "description": "Array of attachment references if attachments were included. Null if no attachments."
              },
              "audit_type": {
                "type": "string",
                "enum": ["identify", "sign", "message"],
                "description": "Type of action: identify (Identify API), sign (Sign API), message (Message API with signature)"
              },
              "requester_name": {
                "type": "string",
                "description": "Display name of the requester (business or admin)"
              },
              "signatoree_name": {
                "type": "string",
                "description": "Full name of the user who signed or declined"
              },
              "requester_business_name": {
                "type": "string",
                "description": "Business name of the requesting organization"
              },
              "signed_accepted": {
                "type": "boolean",
                "description": "True if the user signed/accepted, false if declined"
              }
            }
          },
          "attachments": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "filename": {
                  "type": "string",
                  "description": "Original filename of the attachment"
                },
                "content_type": {
                  "type": "string",
                  "description": "MIME type of the attachment (always application/pdf)"
                },
                "content": {
                  "type": "string",
                  "description": "Base64-encoded file content"
                },
                "size": {
                  "type": "integer",
                  "description": "File size in bytes"
                }
              }
            },
            "description": "Array of PDF attachments. Empty array if no attachments."
          }
        }
      },
      "WebhookTestRequest": {
        "type": "object",
        "required": ["webhook_url", "event_type"],
        "properties": {
          "webhook_url": {
            "type": "string",
            "format": "uri",
            "description": "Your webhook endpoint URL to test"
          },
          "event_type": {
            "type": "string",
            "enum": [
              "authentication.completed",
              "authentication.failed",
              "signature.completed",
              "signature.declined",
              "message.delivered",
              "message.read"
            ],
            "description": "Type of webhook event to simulate"
          }
        }
      },
      "WebhookTestResponse": {
        "type": "object",
        "properties": {
          "test_id": {
            "type": "string",
            "description": "Unique test identifier"
          },
          "webhook_url": {
            "type": "string",
            "description": "The webhook URL that was tested"
          },
          "status": {
            "type": "string",
            "enum": ["sent", "failed"],
            "description": "Test delivery status"
          },
          "response_code": {
            "type": "integer",
            "description": "HTTP response code from your webhook"
          },
          "response_time_ms": {
            "type": "integer",
            "description": "Response time in milliseconds"
          },
          "sent_at": {
            "type": "string",
            "format": "date-time",
            "description": "Test sent timestamp"
          },
          "error_message": {
            "type": "string",
            "description": "Error message if test failed"
          }
        }
      },
      "Error": {
        "type": "object",
        "required": ["error"],
        "properties": {
          "error": {
            "type": "object",
            "required": ["code", "message"],
            "properties": {
              "code": {
                "type": "string",
                "description": "Error code"
              },
              "message": {
                "type": "string",
                "description": "Human-readable error message"
              },
              "details": {
                "type": "object",
                "description": "Additional error context"
              }
            }
          },
          "request_id": {
            "type": "string",
            "description": "Request ID for debugging"
          }
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "API Key",
        "description": "Use your UIP API key as a bearer token"
      }
    }
  }
}
